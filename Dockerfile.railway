# BACKUP: Railway Dockerfile - Install deps at runtime
FROM python:3.11-slim

WORKDIR /app

# Only install curl and ffmpeg (system deps)
RUN apt-get update && \
    apt-get install -y --no-install-recommends curl ffmpeg && \
    rm -rf /var/lib/apt/lists/*

# Copy everything
COPY . .

# Create dirs
RUN mkdir -p /app/data/chroma_db /app/data/models /app/uploads

# Environment
ENV PYTHONPATH=/app \
    PYTHONUNBUFFERED=1 \
    PORT=8000 \
    WHISPER_MODEL=tiny

# Install dependencies at RUNTIME (not build time)
CMD pip install --no-cache-dir -q fastapi uvicorn cerebras-cloud-sdk chromadb sentence-transformers openai-whisper pydub python-dotenv PyPDF2 python-docx pydantic pydantic-settings Pillow && \
    python -m uvicorn src.api.main:app --host 0.0.0.0 --port ${PORT}
